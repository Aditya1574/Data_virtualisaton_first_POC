<!DOCTYPE html>
<html>
<head>
    <title>Select Tables and Columns</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles_display_view.css') }}">
</head>
<body>
    <h1>Select Tables and Columns</h1>
    <form action="/display_views" method="post" id="myForm" class="config-form">
        <ul class="table-list">
            {% for table_name, columns in data.items() %}
                <li class="table-item">
                    <label>{{ table_name }}:</label>
                    <br>
                    <div class="checkbox-list">
                        {% for column in columns %}
                            <label class="checkbox-label">
                                <input type="checkbox" id="{{ column }}" name="{{ column }}" value="{{ column }}">
                                {{ column }}
                            </label>
                        {% endfor %}
<!--                        <select class="foreign-key-select" name="foreign_key_{{ column }}">-->
<!--                                <option value="">Select Foreign Key</option>-->
<!--                                {% for fk_column in columns %}-->
<!--                                    <option value="{{ fk_column }}">{{ fk_column }}</option>-->
<!--                                {% endfor %}-->
<!--                        </select>-->
                    </div>
                </li>
            {% endfor %}
        </ul>
        <input type="hidden" id="selectedData" name="selectedData" value="">
        <input type="hidden" id="selectedForeignKeydData" name="selectedForeignKeydData" value="">
        <input type="hidden" id="dataBaseName" name="dataBaseName" value="{{ databasename }}">
        <button type="button" id="submitButton" class="submit-button">Submit</button>
    </form>
    <script>
        $(document).ready(function() {
        var selectedData = {};
        var selectedForeignKeys = {};
        var table  = ""
        var tableLabel = ""
        $("input[type='checkbox']").on("change", function() {
            tableLabel = $(this).closest("li").find("label").eq(0);
            table = tableLabel.text().trim();
            var column = $(this).attr("value");


            if ($(this).is(":checked")) {
                if (!selectedData[table]) {
                    selectedData[table] = [];
                }
                selectedData[table].push(column);


            } else {
                var index = selectedData[table].indexOf(column);
                if (index !== -1) {
                    selectedData[table].splice(index, 1);
                }

                if (selectedForeignKeys[table]) {
                    delete selectedForeignKeys[table];
                }
            }
        });

         $(".foreign-key-select").on("change", function() {
                    tableLabel = $(this).closest("li").find("label").eq(0);
                    table = tableLabel.text().trim();
                    var foreignKey = $(this).val();
                    if (foreignKey) {
                    selectedForeignKeys[table] = foreignKey;
                    }
           });

        $("#submitButton").click(function() {
            console.log(selectedData);
            console.log(selectedForeignKeys);
            $("#selectedData").val(JSON.stringify(selectedData));
            $("#selectedForeignKeydData").val(JSON.stringify(selectedForeignKeys));
            $("#myForm").submit();
        });
    });
    </script>
</body>
</html>
